<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="robots" content="none,noindex,nofollow">
  <meta name="description" content="ハンドメイドショップサイト">
  <meta name="keywords" content="ECサイト">
  <title>U labeler</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <link href="/stylesheets/top.css" rel="stylesheet" type="text/css">
  </link>

</head>
<header class="header">

  <div class="header_logo">
    <h1><a href="/"><img src="/images/system/logo.png" alt="Ulabeler"></a></h1>
  </div>

  <!-- 検索ボックス -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <span class="magnifying_glass"></span>
  <form method="get" action="#" class="search_container">
    <input type="text" size="25" placeholder="キーワード検索">
    <input type="submit" value="&#xf002">
  </form>

  </div>


  <body>

    <input type="checkbox" id="nav1">
    <label for="nav1" class="open"><span></span></label>
    <label for="nav1" class="close"></label>


    <%- include("../components/login.ejs") %>
      <%- include("../components/sidemenu.ejs", {side_menu: side_menu}) %>

        <article>

          <div class="box09">

            <!-- 入力フォーム -->
            <form action="" method="post" id="hoge">
              <div class="login_input">
                <div class="input_center">
                  <p>仮のパスワード<font color="red">*</font>　　　　　　　:　<input type="text" name="temp_password" size="35"></p>
                </div>
                <div class="password_update_error">
                  <p id="" class="error_message3">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p><!-- やま jsエラーメッセージ -->
                </div>
                <div class="input_center">
                  <p>新しいパスワード<font color="red">*</font>　　　　　　:　<input type="password" name="new_password" size="35"
                      placeholder="半角英数字8文字以上15文字以内"></p>
                </div>
                <div class="input_center">
                  <p>新しいパスワード（確認用）<font color="red">*</font>　:　<input type="password" name="new_password_confirmation"
                      size="35" placeholder="半角英数字8文字以上15文字以内"></p>
                </div>
                <div class="password_update_error">
                  <p id="" class="error_message3">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</p><!-- やま jsエラーメッセージ -->
                </div>
              </div>

            </form>

            <div class="double_button">
              <button type="submit" class="white_button" onclick="location.href='top.html'">戻る</button>
              <button type="submit" class="black_button" onclick="resetPasswordAttempt()">決定</button>
            </div>


          </div>

          <noscript>
            <p>JavaScriptを有効にしてください。</p>
          </noscript>

        </article>
        <br>
        <p><a href="/"><span class="iro3">Copyright&copy; U labeler</span></p></a>
        <br>
  </body>

  <script>
    //変数定義
    const url = new URL(window.location.href);
    const id = url.searchParams.get("id");
    const token = url.searchParams.get("token");
    const temp_password = document.querySelector('input[name="temp_password"]');
    const new_password = document.querySelector('input[name="new_password"]');
    const new_password_confirmation = document.querySelector('input[name="new_password_confirmation"]');

    function resetPasswordAttempt() {
      console.log(id);
      console.log(token);
      console.log(temp_password.value);
      console.log(new_password.value);
      console.log(new_password_confirmation.value);

      axios.post('/api/user/reset_password_attempt', {
        id: id,
        token: token,
        temp_password: temp_password.value,
        new_password: new_password_confirmation.value
      })
        .then(function (response) {
          console.log(response);
          //200と、trueが帰ったら
          if (response.status == 200) {
            alert('パスワードを変更しました。');
            location.href = '/';
          } else {
            console.log(response.status);
            alert('パスワードの変更に失敗しました。');
          }
        })
        .catch(function (error) {
          console.log(error);
        });
    }
  </script>

</html>