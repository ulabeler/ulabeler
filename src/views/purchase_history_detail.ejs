<!DOCTYPE html>
<html lang="ja">

<head>
    <%- include("./components/lib.ejs") %>
        <title>U labeler</title>
</head>
<header class="header">
    <%- include("./components/header.ejs") %>
    <body>
        <%- include("./components/sidemenu.ejs", {side_menu: side_menu}) %>
        <article>
            <div class="footerFixed">
            <!-- ページ名 -->
            <div class="inquiry_title">
                <h3>購入履歴詳細
                    <hr>
                </h3>
            </div>

            <div class="naiyou1">
                <table class="naiyou">
                    <tr>
                        <th>注文日：</th>
                        <th><% const purchased_at=new Date(purchaseHistory[index].purchased_at)%>
                            <%= purchased_at.getFullYear() + "/" + ('00' + (purchased_at.getMonth()+1)).slice(-2) + "/" +
                                ('00' + purchased_at.getDate()).slice(-2) %></th>
                        <th>　配達日： </th>
                        <th>
                            <% if (true) { %>
                                未確定
                            <% } %>
                        </th>
                        <th>　注文番号： </th>
                        <th>
                            <%= purchaseHistory[index].id %>
                        </th>
                        <th>　合計金額： </th>
                        <th>
                            <% let sumAmount = 0; %>
                            <% for( let i = 0; i < purchaseHistory[index].itemsDetail.length; i++ ) { %>
                                <% sumAmount += parseInt(purchaseHistory[index].itemsDetail[i].unitPrice) * purchaseHistory[index].itemsDetail[i].quantity %>
                            <% } %>
                            <%= sumAmount %>円
                        </th>
                    </tr>
                </table>
            </div>
            <br>


            <div class="cart_flex">
                <p>商品</p>
                <p class="">数量</p>
                <p class="total2">合計</p>
            </div>
            <hr class="cart_hr">




            <% for( let i = 0; i < purchaseHistory[index].itemsDetail.length; i++ ) { %>
                <div class="cart_item_flex">
                    <div class="cart_image">
                    <img src="<%= purchaseHistory[index].itemsDetail[i].workImagePath %>" alt="商品画像">
                    <div class="cart_item_detail">
                        <p>素体名:<%= purchaseHistory[index].itemsDetail[i].baseCategoryName %></p>
                        <p>作品名:「<%= purchaseHistory[index].itemsDetail[i].workName %>」</p>
                        <!-- <p>カラー:あああ</p>
                        <p>サイズ:あああああ</p> -->
                        <p>数量: <%= purchaseHistory[index].itemsDetail[i].quantity %></p>
                        <p>金額: ¥<%= purchaseHistory[index].itemsDetail[i].unitPrice %></p>
                    </div>
                    <div class="cart_item_kazu">
                        <div class="">
                            <p>
                                <%= purchaseHistory[index].itemsDetail[i].quantity %>
                            </p>
                        </div>
                </div>
                <div class="total">
                    <p><%= parseInt(purchaseHistory[index].itemsDetail[i].unitPrice) * purchaseHistory[index].itemsDetail[i].quantity %></p>
                </div>
            </div>
        </div>
        <hr class="cart_hr">
            <% } %>

            <div class="cart_flex3">

                <p class="count1">小計</p>
                <p>¥4000</p>
            </div>
            <div class="cart_flex3">
                <div class="count1">
                    <p>配送料</p>
                </div>
                <p>¥300</p>
            </div>
            <hr class="cart_hr">
            <div class="cart_flex3">
                <div class="count1">
                    <p>合計</p>
                </div>
                <p>¥4300</p>
            </div>
            <br><br>

            <div class = "subtitle"><img src="/images/system/delivery.png" class="delivery_card" alt="配送情報"></div>

            <div class="purchase_2">
                <form action="" method="post" id="hoge">
                    <table>
                        <tr>
                            <td>
                                <div class="purchase_box2">
                                    <table cellpadding="10">
                                        <tr>
                                            <th>配達日付　: </th>
                                            <td><%= estimatedDeliveryTimeCategory %></td>
                                            <td>18時~20時</td>
                                            <input type="hidden" name="">
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td>

                            </td>
                        </tr>
                    </table>
                </form>
            </div>

            <div class="purchase_2">
                <form action="" method="post" id="hoge">
                    <table>
                        <tr>
                            <td>
                                <div class="purchase_box2">
                                    <table cellpadding="10">
                                        <tr>
                                            <th>お名前　　: </th>
                                            <td><%= deliveryAddress[0].familyname %></td>
                                            <td><%= deliveryAddress[0].firstname %></td>
                                            <input type="hidden" name="">
                                        </tr>
                                        <tr>
                                            <th>ふりがな　: </th>
                                            <td><%= deliveryAddress[0].familyname_furigana %></td>
                                            <td><%= deliveryAddress[0].firstname_furigana %></td>
                                            <input type="hidden" name="">
                                        </tr>
                                        <tr>
                                            <th>住所　　　: </th>
                                            <td>〒
                                                <% if (deliveryAddress[0].zip_code.includes("-")) { %>
                                                    <%= deliveryAddress[0].zip_code %> 
                                                   <% } else { %>
                                                       <%= deliveryAddress[0].zip_code.substr(0, 3) %>-<%= deliveryAddress[0].zip_code.substr(3, 7) %>
                                                       <% } %> 
                                               </td>
                                            <input type="hidden" name="">
                                        </tr>
                                        <tr>
                                            <th></th>
                                            <td colspan="2"><%= deliveryAddress[0].address %></td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td>

                            </td>
                        </tr>
                    </table>
                </form>
            </div>
            <div class = "subtitle"><img src="/images/system/card_information.png" class="delivery_card" alt="～支払情報～"></div>
            <div class="purchase_2">
                <form action="" method="post" id="hoge">
                    <table>
                        <tr>
                            <td>
                                <div class="purchase_box2">
                                    <table cellpadding="10">
                                        <tr>
                                            <th>支払方法　: </th>
                                            <% if (paymentMethod[0].name_card == "PayPay") { %>
                                                <td>PayPay</td>
                                            <% } else if (paymentMethod[0].name_card == null) { %>
                                                <td>PayPay</td>
                                            <% } else { %>
                                                <td>
                                                    <%# 先頭12桁を"*"に置き換える" %>  
                                                    <%# paymentMethod[0].cardnumberを、4桁ずつに区切り、"-"を挿入する %>
                                                    <% var cardnumber = paymentMethod[0].cardnumber %>
                                                    <% var cardnumber_1 = cardnumber.substr(0, 4) %>
                                                    <% var cardnumber_2 = cardnumber.substr(4, 4) %>
                                                    <% var cardnumber_3 = cardnumber.substr(8, 4) %>
                                                    <% var cardnumber_4 = cardnumber.substr(12, 4) %>
                                                    <% cardnumber_1 = cardnumber_1.replace(/[0-9]/g, "*") %>
                                                    <% cardnumber_2 = cardnumber_2.replace(/[0-9]/g, "*") %>
                                                    <% cardnumber_3 = cardnumber_3.replace(/[0-9]/g, "*") %>
                                                    <% cardnumber_4 = cardnumber_4 %>
                                                    <% cardnumber = cardnumber_1 + "-" + cardnumber_2 + "-" + cardnumber_3 + "-" + cardnumber_4 %>
                                                    <%= cardnumber %>
                                                </td>
                                                <td>クレジットカード</td>
                                            <% } %> 
                                            <input type="hidden" name="">
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td>

                            </td>
                        </tr>
                    </table>
                </form>
            </div>
            <br>
            <hr class="cart_hr">
            <div class="button">
                <!-- 閉じるボタン（ポップアップ閉じるボタン）jsページ -->
                <button id="" class="white_button" onclick="window.history.back()">閉じる</button>
            </div>
        </div>
        </article>
        <%- include("./components/login.ejs") %>
        <%- include("./components/footer.ejs") %>
</body>

</html>