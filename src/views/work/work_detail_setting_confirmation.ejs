<!DOCTYPE html>
<html lang="ja">

<head>
    <%- include("../components/lib.ejs") %>
    <title>U labeler</title>
</head>
<header class="header">

    <div class="header_logo">
        <h1><a href="/"><img src="/images/system/logo.png" alt="Ulabeler"></a></h1>
    </div>

    <!-- 検索ボックス -->
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <span class="magnifying_glass"></span>
    <form method="get" action="#" class="search_container">
        <input type="text" size="25" placeholder="キーワード検索">
        <input type="submit" value="&#xf002">
    </form>

    <body>

        <input type="checkbox" id="nav1">
        <label for="nav1" class="open"><span></span></label>
        <label for="nav1" class="close"></label>

        <%- include("../components/sidemenu.ejs", {side_menu: side_menu}) %>

            <article>
                <br>
                <br>

                <!-- ページ名 -->
                <h3 class="h3_center2">作品詳細設定
                    <hr>
                </h3>

                <!-- ページ名 -->
                <h3 class="h3_center2">作品詳細設定確認
                    <hr>
                </h3>

                <section class="box_item_4">
                    <br>
                    <div class="userpage">
                        <div class="user_3">
                            <form action="" method="post" id="hoge">
                                <div class="user_box_1">
                                    <a href="">
                                        <table cellpadding="0" 　class="usertable">

                                            <tr>
                                                <th rowspan="4">
                                                    <p class=user_img2><img src="<%- userInfo.icon_path %>"
                                                            alt="ユーザーアイコン"></p>
                                                </th>
                                                <td>　　　　　</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p class="username">
                                                        <%- userInfo.name %>
                                                    </p>
                                                </td>
                                                <input type="hidden" name="">

                                            </tr>
                                            <tr>
                                                <td class="userid2">＠<%- userInfo.id %>
                                                </td>
                                                <input type="hidden" name="">
                                            </tr>


                                        </table>
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class=userpage>
                    </div>
                    <p class="date1">
                        <%# work.create_atをyyyy/mm/ddで表示する %>
                            <% const create_at=new Date(work.create_at)%>
                                <%= create_at.getFullYear() + "/" + ('00' + (create_at.getMonth()+1)).slice(-2) + "/" +
                                    ('00' + create_at.getDate()).slice(-2) %>
                    </p>
                    <div class="image_wrapper"><img src="<%= work.thumbnail_path %>" alt="<%- newName %>" /></div>
                    <form action="select_color.html" method="post">
                        <input type="hidden" id="workId" value="<%- work.id %>">
                        <p class="tannka">単価：<%- work.unit_price %> 円　</p>
                        <p class="explanation"><%- baseCategory.name_subcategory %></p>
                        <h3 class="sakuhinnmei" id="newName">「<%-newName%>」</h3>
                        <div class="explanation2"><a href="">
                                <font size="2">
                                    <%# hashTagを表示する。それぞれの間には" "を入れる" %>
                                    <% for( let index = 0; index < hashTag.length; index++ ) { %>
                                        <%= hashTag[index] %>
                                        <% if( index < hashTag.length - 1 ) { %>
                                            <%= " " %>
                                            <% } %>
                                            <% } %>
                                </font>
                            </a></p>
                        </div>
                        <br>
                        <p class="explanation3"><%- newIntroduction %> </p>
                        <br>

                        <div class="check">
                            <input id="newIsPublic" type="checkbox" class="check1" name="check" <%- newIsPublic %> disabled>公開
                        </div>
                        <div class="double_button4">
                            <table class="button_table">
                                <tr>
                                    <th style="width: 20%;"></th>
                                    <th><button type="button" class="white_button2"
                                            onclick="history.back()">戻る</button></th>
                                    <th style="width: 30%;"></th>
                                    <th><button type="button" class="black_button2" onclick="change()">保存</button></th>
                                    <th style="width: 20%;"></th>
                                </tr>
                            </table>
                            <br>

                        </div>
                    </form>
                </section>

                </div>

                </div>

                <noscript>
                    <p>JavaScriptを有効にしてください。</p>
                </noscript>
            </article>
            <%- include("../components/footer.ejs") %>
    </body>

    <script>
        const newIsPublic = document.getElementById("newIsPublic");
        const workId = document.getElementById("workId").value;
        const rawNewName = document.getElementById("newName");

        //rawnewNameから"「"を削除し、"」"を削除する
        let newName = rawNewName.innerText.replace(/「/g, '').replace(/」/g, '');

        function change(){
            console.log(newIsPublic.checked);
            axios.post(`/work/${workId}/edit/submit`, {
                newIsPublic: newIsPublic.checked,
                newName: newName
            })
            .then(function(response){
                if (response.status == 200 && response.data) {
                    alert("保存しました");
                    location.href = "/my_work";
                }
            })
            .catch(function(error){
                console.log(error);
                alert("保存に失敗しました");
            });
        }
    </script>
</html>