<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="robots" content="none,noindex,nofollow">
  <meta name="description" content="ハンドメイドショップサイト">
  <meta name="keywords" content="ECサイト">
  <title>U labeler</title>

  <link href="/stylesheets/top.css" rel="stylesheet" type="text/css">
  </link>
  <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
  <!-- axios -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>

</head>
<header class="header">

  <div class="header_logo">
    <h1><a href="/"><img src="/images/system/logo.png" alt="ロゴ"></a></h1>
  </div>

  <!-- 検索ボックス -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <span class="magnifying_glass"></span>
  <form method="get" action="#" class="search_container">
    <input type="text" size="25" placeholder="キーワード検索">
    <input type="submit" value="&#xf002">
  </form>

  </div>


  <body>

    <input type="checkbox" id="nav1">
    <label for="nav1" class="open"><span></span></label>
    <label for="nav1" class="close"></label>


    <nav class="menu">
      <h2 href="template.html">U labelar</h2>
      <ul>
        <% for (let i = 0; i < side_menu.length; i++) { %>
          <li><a href='<%= side_menu[i].link %>' 
            <% if(side_menu[i].title == "ログイン") { %>
              class="<%= "js-popup_login" %>"
            <% } %> 
            ><%= side_menu[i].title %></a></li>
        <% } %>
      </ul>
    </nav>

    <article>

      <!-- ポップアップの中身 -->

      <div class="popup">
        <div class="popup-inner">
          <div class="close-btn" id="js-close-btn"><i class="fas fa-times"></i></div>
          <div class="box09">

            <!-- ページ名 -->
            <h3>ログイン
              <hr>
            </h3>
              <div class="login_input">
                <div class="input_center">
                  <p>メールアドレスまたはユーザーID<font color="red">*　</font>:　<input type="text" name="username" size="40" id="username"></p>
                </div>
                <div class="input_center">
                  <p>パスワード<font color="red">*</font>　　　　　　　　　　　:　<input type="password" name="password" size="30"
                      placeholder="半角英数字８文字以上20文字以内" id="password"></p>
                </div>
              </div>

              <div class="button">
                <input type="submit" class="black_button" value="ログイン" onclick="loginAttempt()">
              </div>

            <!-- エラーメッセージ -->
            <div class="" id="errormessage">
            </div>

            <!-- リンク -->
            <div class="login_link">
              <a href="/sign_up">新規会員登録はこちら</button><br>
                <a href="mail_address_input.html">パスワードをお忘れの方</a>
            </div>

          </div>


          <noscript>
            <p>JavaScriptを有効にしてください。</p>
          </noscript>

          <!-- <button id="js-show-popup">Show Popup</button> -->
        </div>
        <div class="black-background" id="js-black-bg"></div>
      </div>

      <button class="js-popup_login">ログイン</button>
      <p id="show_username"></p>

      <script src="/javascripts/pop-up.js"></script>
    </article>
    <br>
    <p><a href="#"><span class="iro3">Copyright&copy; U labeler</span></p></a>
    <br>
    <a href="customize_editing.html" id="pagetop"><i class="up"></i>↑</a>
  </body>

  <script>
    //変数定義
    const errormessage_area = document.getElementById('errormessage');
    const password = document.getElementById('password');
    const username = document.getElementById('username');
    function loginAttempt(){
      //axiosを利用して、/api/user/sign_inへPOSTリクエストを送信
      axios.post('/api/user/v2_sign_in', {
        username: username.value,
        password: password.value
      })
      //401エラーが返ってきた場合、errormessage_areaにinnerHTMLでエラーメッセージを表示
      .then(function (response) {
        if (response.data === false) {
          //errormessage_areaにclass=login_error_boxを追加
          errormessage_area.classList.add('login_error_box');
          errormessage_area.innerHTML = '<p>入力されたユーザーIDまたはパスワードが正しくありません。<br>ユーザーIDとパスワードを確認して、もう一度お試しください。</p>';
        }
        else if (response.data === true) {
          errormessage_area.innerHTML = '<p>ログインに成功しました。</p>';
          //ログインに成功した場合、ログインページを閉じる
          setTimeout(function () {
            window.location.href = '/';
          }, 1000);
        }
      })
    }
  </script>

</html>