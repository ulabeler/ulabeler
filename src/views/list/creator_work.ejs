<!DOCTYPE html>
<html lang="ja">

<head>
  <%- include("../components/lib.ejs") %>
    <title>U labeler</title>
</head>
<header class="header">
  <%- include("../components/header.ejs") %>

    <body>
      <%- include("../components/sidemenu.ejs", {side_menu: side_menu}) %>
        <%- include("../components/login.ejs") %>

          <article>
            <div class="footerFixed">
            <br>
            <br>

            <div class="userpage">

              <div class="user_2">
                <div class="user_box">
                  <table cellpadding="0" 　class="usertable">

                    <tr>
                      <th rowspan="4">
                        <p class=user_img><img src="<%- userInfo.icon_path %>" alt="ユーザーアイコン"></p>
                      </th>
                      <td>　　　　　</td>
                    </tr>
                    <tr>
                      <td>
                        <p class="username">
                          <%- userInfo.name %>
                        </p>
                      </td>
                      <input type="hidden" name="">

                    </tr>
                    <tr>
                      <td>
                        <p class="userid" id="userId">@<%- userInfo.id %>
                        </p>
                      </td>
                      <input type="hidden" name="">
                    </tr>
                    <tr>
                      <td colspan="2" class="setumei">
                        <%- userInfo.self_introduction %>
                      </td>

                    </tr>


                  </table>
                </div>
              </div>
            </div>
            <div class=userpage>
              <div class="td2">
                <div id="click">
                  <label><input type="checkbox" name="favorite" id="favCheck">
                    <div class="star2_1 pyon" onclick="setUserFav('<%- userInfo.id %>')">★</div>
                  </label>
                </div>
                <p class="favorite" id="userFavNum"></p>
              </div>
            </div>


            <p class="senn">
              <%- currentPageDescription.title %>
                <hr class="hr3">
            </p>

            <div id="js-show-popup">
              <div class="box_wrapper_2">

                <%- include("../components/workListOverViewWOCreatorInfo", { workList :workList, idx: idx, maxPage: maxPage,
                  maxViewOnPage: maxViewOnPage, currentPage: currentPage, userInfo: userInfo, currentPageDescription:
                  currentPageDescription, }) %>


              </div>
            </div>


            <%- include("../components/workListDetail.ejs", { workList :workList, idx: idx, maxPage: maxPage,
              maxViewOnPage: maxViewOnPage, currentPage: currentPage, userInfo: userInfo, currentPageDescription:
              currentPageDescription,isMine: isMine}) %>

</div>
          </article>
          <br>
          <%- include("../components/listPagenation.ejs", { workList :workList, idx: idx, maxPage: maxPage,
            maxViewOnPage: maxViewOnPage, currentPage: currentPage, userInfo: userInfo, currentPageDescription:
            currentPageDescription,isCreatorView: isCreatorView }) %>
            <%- include("../components/footer.ejs") %>
    </body>

    <script>
      // \nが含まれていたら除去
      // スーペースが含まれていたら除去
      const userId = document.getElementById('userId').innerHTML.slice(1).replace(/\n/g, '').replace(/\s/g, '');

      function getUserFavNum(userId) {
        axios.post('/api/work/getuserfavnum', {
          id: userId
        })
          .then(function (response) {
            console.log(response);
            document.getElementById('userFavNum').innerHTML = response.data.number;
            document.getElementById('favCheck').checked = response.data.isFavorite ? true : false;
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function setUserFav(userId) {
        axios.post(`/api/user/favorite/${userId}`)
          .then(function (response) {
            console.log(response);
            getUserFavNum(userId);
          })
          .catch(function (error) {
            console.log(error);
            // checkedの状態を戻す
            if (error.response.status === 401) {
              alert('お気に入り登録するには、ログインしてください');
            }
            if (document.getElementById('favCheck').checked) {
              document.getElementById('favCheck').checked = false;
            } else {
              document.getElementById('favCheck').checked = true;
            }
          });
      }
      window.addEventListener('DOMContentLoaded', function () {
        getUserFavNum(userId);
      });
    </script>
    <script src="/javascripts/searchInit.js"></script>

</html>